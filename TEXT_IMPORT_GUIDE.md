# 从文本文件导入目录功能说明

## 功能概述

现在项目支持从 `toc.txt` 文本文件导入目录并写入到 PDF 文件中。这对于以下场景非常有用：
- 手动修正 AI 识别的目录
- 使用已有的目录文本文件
- 批量处理多个 PDF 使用相同的目录结构

## 使用方法

### 方法一：命令行模式

```bash
# 从 toc.txt 导入目录并写入 PDF
python main.py --from-txt temp/toc.txt --pdf your_book.pdf --output your_book_with_toc.pdf
```

**参数说明：**
- `--from-txt`: 文本文件路径（支持 export_toc_to_text 导出的格式）
- `--pdf`: 目标 PDF 文件路径
- `--output`: 输出文件路径（可选，不提供则覆盖原文件）

### 方法二：交互式模式

```bash
python main.py
```

然后：
1. 选择 `2` - 文本导入模式
2. 输入 toc.txt 文件路径
3. 输入目标 PDF 文件路径
4. 确认执行

## 文本格式要求

文本文件需要按照以下格式（这是 `export_toc_to_text()` 自动生成的格式）：

```
============================================================
PDF 目录
============================================================

文件: /path/to/original.pdf
页码偏置: 11
总条目数: 145

------------------------------------------------------------

第1章 标题 ... 1 (PDF: 11)
  1.1 小节 ... 1 (PDF: 11)
  1.2 小节 ... 2 (PDF: 12)
    1.2.1 子小节 ... 4 (PDF: 14)
第2章 标题 ... 25 (PDF: 35)
```

**格式说明：**
- 使用 2 个空格表示层级缩进
- 格式：`标题 ... 页码 (PDF: 实际页码)`
- 支持最多 5 级目录层级
- 元数据行（文件、页码偏置）可选，但建议保留

## 工作流程示例

### 场景 1：修正 AI 识别结果

```bash
# 1. 先用 OCR 模式识别目录
python main.py --pdf book.pdf --range 8-10 --offset 11

# 2. 修改生成的 temp/toc.txt 文件（手动修正错误）

# 3. 从修正后的文本重新写入
python main.py --from-txt temp/toc.txt --pdf book.pdf --output book_corrected.pdf
```

### 场景 2：使用已有目录文本

```bash
# 直接从已有的 toc.txt 导入
python main.py --from-txt my_toc.txt --pdf book.pdf --output book_with_toc.pdf
```

## 注意事项

1. **页码偏置**：文本文件中应包含页码偏置信息，或者确保页码已经是最终要使用的值
2. **文件路径**：支持相对路径和绝对路径
3. **备份**：建议使用 `--output` 参数输出到新文件，避免覆盖原文件
4. **格式兼容**：目前仅支持 `export_toc_to_text()` 生成的格式

## 与原有功能的对比

| 功能 | OCR 识别模式 | 文本导入模式 |
|------|-------------|-------------|
| 输入 | PDF 图片 | toc.txt 文件 |
| 处理时间 | 较长（需要 AI 识别）| 极快（直接解析）|
| 准确性 | 依赖 AI 模型 | 取决于文本内容 |
| 适用场景 | 首次处理 PDF | 修正或复用目录 |
| 需要 API | 是 | 否 |

## 示例文本文件

项目已有示例：`temp/toc.txt`

你可以参考这个文件的格式来创建自己的目录文本文件。
